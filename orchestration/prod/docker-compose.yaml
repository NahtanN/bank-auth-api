services:
  #kong-database:
  #image: postgres:13
  #environment:
  #POSTGRES_USER: kong
  #POSTGRES_DB: kong
  #POSTGRES_PASSWORD: kong
  #ports:
  #- "5432:5432"
  #volumes:
  #- kong-data:/var/lib/postgresql/data

  #kong-migrations:
  #image: kong:3.7
  #command: kong migrations bootstrap
  #environment:
  #KONG_DATABASE: postgres
  #KONG_PG_HOST: kong-database
  #KONG_PG_USER: kong
  #KONG_PG_PASSWORD: kong
  #depends_on:
  #- kong-database

  kong:
    image: kong:3.7
    environment:
      #KONG_DATABASE: postgres
      #KONG_PG_HOST: kong-database
      #KONG_PG_USER: kong
      #KONG_PG_PASSWORD: kong
      KONG_DATABASE: "off"
      KONG_PROXY_ACCESS_LOG: /dev/stdout
      KONG_ADMIN_ACCESS_LOG: /dev/stdout
      KONG_PROXY_ERROR_LOG: /dev/stderr
      KONG_ADMIN_ERROR_LOG: /dev/stderr
      KONG_ADMIN_GUI_URL: http://localhost:8002
      KONG_PORTAL_GUI_HOST: 0.0.0.0:8003
      KONG_ADMIN_LISTEN: 0.0.0.0:8001, 0.0.0.0:8444 ssl
      KONG_DECLARATIVE_CONFIG: /etc/kong/kong.yml
    ports:
      - "8000:8000" # Kong proxy port
      - "8443:8443" # Kong proxy SSL port
      - "8001:8001" # Kong admin API port
      - "8444:8444" # Kong admin API SSL port
      - "8002:8002"
    depends_on:
      - kong-migrations
    volumes:
      - ./kong:/etc/kong/ # This is required to expose the Kong Admin GUI on the host machine
    extra_hosts:
      - host.docker.internal:host-gateway

volumes:
  kong-data:
